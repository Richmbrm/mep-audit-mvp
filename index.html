<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MEP Audit Viewer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
  <div id="app">
    <div class="beta-banner">
      <span class="beta-tag">BETA MVP</span>
      <span class="version-tag">v1.5</span>
      <span class="banner-msg">Continuous Improvement in Progress</span>
    </div>
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem;">
      <div style="text-align: left;">
        <h1>MEP Audit Viewer</h1>
        <p style="color: var(--color-text-dim); display: flex; align-items: center; gap: 1rem;">
          Compliance Validation & Engineering Intelligence Dashboard
          <a href="history.html"
            style="font-size: 0.7rem; color: var(--color-primary); text-decoration: none; border: 1px solid var(--color-primary); padding: 0.1rem 0.6rem; border-radius: 4px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">Release
            History</a>
        </p>
      </div>
      <button id="resetBtn" class="secondary-btn">üîÑ Reset Interface</button>
    </header>

    <section class="onboarding-panel animate-in">
      <div class="onboarding-grid">
        <div class="onboarding-item">
          <span class="step-num">1</span>
          <h4>Select Source</h4>
          <p>Choose a CSV from the server or upload your own local equipment schedule below.</p>
        </div>
        <div class="onboarding-item">
          <span class="step-num">2</span>
          <h4>Validate</h4>
          <p>Our Python agent analyzes ACH, Room Volume, and Equipment specs against ISO standards.</p>
        </div>
        <div class="onboarding-item">
          <span class="step-num">3</span>
          <h4>Insight</h4>
          <p>Review the compliance dashboard and use the AI Expert to troubleshoot failures.</p>
        </div>
      </div>
      <div style="margin-top: 1.5rem; text-align: center; font-size: 0.875rem; color: var(--color-primary);">
        üëá <strong>Get started by running a new audit below</strong>
      </div>
    </section>

    <section class="run-audit-section">
      <div class="card">
        <span class="card-title">Run New Audit to create a new .json report</span>

        <div class="audit-options-container">
          <!-- Option 1: Existing File -->
          <div class="audit-option">
            <label class="option-label">Option 1: Select from Server</label>
            <div class="form-group">
              <label for="fileSelect" style="display: flex; justify-content: space-between;">
                Source File
                <span id="refreshFiles" style="cursor: pointer; font-size: 0.8rem; color: var(--color-primary);">üîÑ
                  Refresh</span>
                <span id="lastUpdated"
                  style="font-size: 0.7rem; color: var(--color-text-dim); margin-left: 0.5rem;"></span>
              </label>
              <select id="fileSelect">
                <option value="">Choose File from List</option>
              </select>
            </div>
          </div>

          <div class="option-divider"><span>OR</span></div>

          <!-- Option 2: Upload New File -->
          <div class="audit-option">
            <label class="option-label">Option 2: Process Local File</label>
            <div class="form-group">
              <label for="runFileInput">Choose .csv (To Run) or .json (To View)</label>
              <input type="file" id="runFileInput" accept=".csv,.json" />
            </div>
          </div>
        </div>

        <div class="form-group" style="margin-top: 1.5rem;">
          <label for="jobRefInput">Job Reference</label>
          <input type="text" id="jobRefInput" placeholder="e.g. CITY-AUDIT-2025" />
        </div>

        <button id="runBtn" class="primary-btn" style="width: 100%; margin-top: 1rem;">üöÄ Run Audit Now</button>
        <div id="runStatus" class="hidden" style="margin-top: 1rem; color: var(--color-primary); font-size: 0.875rem;">
          ‚öôÔ∏è Processing Audit... please wait...
        </div>
      </div>
    </section>

    <div id="dashboard" class="hidden animate-in">
      <div class="dashboard-grid">
        <div class="card">
          <span class="card-title">Audit Overview</span>
          <div id="runDate" class="card-value">-</div>
          <div id="jobRef" style="color: var(--color-primary); font-weight: 600; margin-top: 0.5rem;">Job: -</div>
          <p id="fileName" style="color: var(--color-text-dim); font-size: 0.875rem; margin-top: 0.5rem;"></p>
        </div>

        <div class="card">
          <span class="card-title">Room Compliance</span>
          <div id="roomMetric" class="card-value">-%</div>
          <div class="status-grid">
            <span id="roomPassCount" class="status-badge status-pass">0 PASSED</span>
            <span id="roomFailCount" class="status-badge status-fail">0 FAILED</span>
          </div>
        </div>

        <div class="card">
          <span class="card-title">Equipment Status</span>
          <div id="equipMetric" class="card-value">-%</div>
          <div class="status-grid">
            <span id="equipPassCount" class="status-badge status-pass">0 PASSED</span>
            <span id="equipFailCount" class="status-badge status-fail">0 FAILED</span>
          </div>
        </div>
      </div>

      <section>
        <h2>Room Validation</h2>
        <div class="table-wrapper">
          <table id="roomTable">
            <thead>
              <tr>
                <th>Room Name</th>
                <th>ACH</th>
                <th>Comfort</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- AI Expert Section -->
      <section id="aiExpert" class="ai-expert-panel animate-in hidden">
        <div class="ai-expert-header">
          <span class="ai-icon">ü§ñ</span>
          <div style="flex: 1;">
            <h3>AI Standards Insight</h3>
            <p style="font-size: 0.75rem; color: var(--color-text-dim)">Context-aware compliance expert</p>
          </div>
          <div class="llm-controls">
            <select id="llmModelSelect" class="mini-select">
              <option value="cniongolo/biomistral:latest">BioMistral 7B (Scientific)</option>
              <option value="llama3.2:latest">Llama 3.2 (Reasoning)</option>
            </select>
            <span id="llmStatus" class="status-dot tooltip">
              <span class="tooltip-text">Local LLM Offline</span>
            </span>
          </div>
        </div>
        <div id="aiExpertContent" class="ai-expert-body">
          <!-- Dynamic content goes here -->
        </div>
        <div class="search-box">
          <input type="text" id="standardsSearch" placeholder="Ask about ISO 14644, ACH, Pressure..." />
          <button id="searchBtn" class="search-btn">üîç Query Standards</button>
          <div id="searchResults" class="search-results hidden"></div>
        </div>
      </section>

      <section id="equipSection">
        <h2>Equipment Schedule</h2>
        <div id="equipNoData" class="hidden"
          style="padding: 3rem; text-align: center; color: var(--color-text-dim); background: rgba(255,255,255,0.02); border-radius: 1rem; border: 1px dashed var(--color-border);">
          <span style="font-size: 2rem; display: block; margin-bottom: 1rem;">üìã</span>
          No data at this time in Equipment Schedule section.
        </div>
        <div id="equipTableWrapper" class="table-wrapper">
          <table id="equipTable">
            <thead>
              <tr>
                <th>Mark</th>
                <th>Category</th>
                <th>Issues</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
  <script type="module" src="/src/main.js"></script>
</body>

</html>